import React, { useState } from 'react';
import { Search, Download, ExternalLink, FileText, Type } from 'lucide-react';

export default function FontScanner() {
  const [url, setUrl] = useState('');
  const [loading, setLoading] = useState(false);
  const [results, setResults] = useState(null);
  const [error, setError] = useState('');
  const [debugInfo, setDebugInfo] = useState([]);
  const [microsoftFonts, setMicrosoftFonts] = useState([]);
  const [fontCacheStatus, setFontCacheStatus] = useState('Not loaded');

  // Base list of common Microsoft fonts (fallback)
  const baseMicrosoftFonts = [
    'segoe', 'calibri', 'cambria', 'candara', 'consolas', 'constantia', 'corbel',
    'arial', 'times new roman', 'verdana', 'tahoma', 'trebuchet', 'georgia',
    'comic sans', 'impact', 'courier new', 'palatino', 'garamond', 'bookman',
    'century gothic', 'franklin gothic', 'ms sans serif', 'ms serif', 'bahnschrift',
    'ebrima', 'gabriola', 'malgun gothic', 'microsoft himalaya', 'microsoft jhenghei',
    'microsoft new tai lue', 'microsoft phagspa', 'microsoft tai le', 'microsoft yahei',
    'microsoft yi baiti', 'mongolian baiti', 'mv boli', 'myanmar text', 'nirmala ui',
    'sitka', 'sylfaen', 'yu gothic'
  ];

  // Fetch Microsoft fonts from official documentation
  const fetchMicrosoftFonts = async () => {
    try {
      setFontCacheStatus('Loading...');
      const proxyUrl = 'https://api.allorigins.win/raw?url=';
      const msUrl = 'https://learn.microsoft.com/en-us/typography/font-list/';
      
      const response = await fetch(proxyUrl + encodeURIComponent(msUrl));
      const html = await response.text();
      
      // Parse the HTML to extract font names
      const parser = new DOMParser();
      const doc = parser.parseFromString(html, 'text/html');
      
      // Microsoft's font list page has links to individual font pages
      const fontLinks = doc.querySelectorAll('a[href*="/typography/font-list/"]');
      const extractedFonts = [];
      
      fontLinks.forEach(link => {
        const fontName = link.textContent.trim().toLowerCase();
        if (fontName && fontName.length > 2 && !fontName.includes('font list')) {
          extractedFonts.push(fontName);
        }
      });
      
      // If we got fonts from the page, use them; otherwise use base list
      if (extractedFonts.length > 10) {
        setMicrosoftFonts([...new Set([...baseMicrosoftFonts, ...extractedFonts])]);
        setFontCacheStatus(`Loaded ${extractedFonts.length} fonts from Microsoft`);
        return extractedFonts.length;
      } else {
        throw new Error('Not enough fonts extracted');
      }
    } catch (err) {
      console.error('Failed to fetch Microsoft fonts:', err);
      setMicrosoftFonts(baseMicrosoftFonts);
      setFontCacheStatus('Using cached list (fallback)');
      return 0;
    }
  };

  // Load Microsoft fonts on component mount
  React.useEffect(() => {
    fetchMicrosoftFonts();
  }, []);

  const categorizeFont = (fontName, fontFiles = []) => {
    const name = fontName.toLowerCase();
    const files = fontFiles.join(' ').toLowerCase();
    
    // Google Fonts - PRIMARY: URL detection (most reliable)
    if (files.includes('fonts.gstatic.com') || 
        files.includes('fonts.googleapis.com') || 
        files.includes('gstatic.com')) {
      return { 
        category: 'Google Fonts', 
        license: 'Free (Open Source)', 
        color: 'green',
        detected: 'URL'
      };
    }
    
    // Adobe Fonts - PRIMARY: URL detection (most reliable)
    if (files.includes('use.typekit.net') || 
        files.includes('typekit.com') || 
        files.includes('typekit.net') ||
        files.includes('adobe.com/fonts')) {
      return { 
        category: 'Adobe Fonts', 
        license: 'Subscription Required', 
        color: 'purple',
        detected: 'URL'
      };
    }
    
    // Microsoft 365 / Windows System Fonts - Use dynamic or fallback list
    const msfontsToCheck = microsoftFonts.length > 0 ? microsoftFonts : baseMicrosoftFonts;
    
    for (const msFont of msfontsToCheck) {
      if (name.includes(msFont)) {
        return { 
          category: 'Microsoft/System', 
          license: 'Bundled with OS', 
          color: 'blue',
          detected: microsoftFonts.length > 0 ? 'Live List' : 'Cached List'
        };
      }
    }
    
    // Secondary detection: Common Google Fonts (if URL detection missed it)
    const commonGoogleFonts = [
      'roboto', 'open sans', 'lato', 'montserrat', 'oswald', 'source sans pro',
      'raleway', 'poppins', 'ubuntu', 'merriweather', 'playfair display',
      'nunito', 'pt sans', 'noto sans', 'inter', 'work sans', 'quicksand',
      'rubik', 'karla', 'mulish', 'dm sans', 'manrope', 'space grotesk'
    ];
    
    for (const gFont of commonGoogleFonts) {
      if (name.includes(gFont)) {
        return { 
          category: 'Google Fonts', 
          license: 'Free (Open Source)', 
          color: 'green',
          detected: 'Name Match'
        };
      }
    }
    
    // Secondary detection: Common Adobe Fonts
    const commonAdobeFonts = [
      'adobe', 'myriad', 'minion', 'garamond pro', 'futura', 'proxima nova',
      'source serif', 'source code', 'tk-', 'acumin', 'brandon', 'museo'
    ];
    
    for (const aFont of commonAdobeFonts) {
      if (name.includes(aFont)) {
        return { 
          category: 'Adobe Fonts', 
          license: 'License May Be Required', 
          color: 'purple',
          detected: 'Name Match'
        };
      }
    }
    
    // Generic/Fallback fonts
    const genericFonts = ['serif', 'sans-serif', 'monospace', 'cursive', 'fantasy', 'system-ui'];
    if (genericFonts.includes(name)) {
      return { 
        category: 'Generic/Fallback', 
        license: 'N/A', 
        color: 'gray',
        detected: 'Generic'
      };
    }
    
    // Third-party fonts - need license verification
    return { 
      category: '3rd Party', 
      license: '‚ö†Ô∏è License Required - Verify', 
      color: 'orange',
      detected: 'Unknown'
    };
  };

  const extractFontsFromCSS = (cssText, sourceUrl) => {
    const fonts = [];
    const fontFamilyUsages = [];
    
    // Match @font-face declarations
    const fontFaceRegex = /@font-face\s*{([^}]+)}/g;
    let match;
    
    while ((match = fontFaceRegex.exec(cssText)) !== null) {
      const block = match[1];
      const font = {
        source: sourceUrl,
        type: 'font-face'
      };
      
      // Extract font-family
      const familyMatch = block.match(/font-family:\s*['"]?([^'";]+)['"]?/i);
      if (familyMatch) font.family = familyMatch[1].trim();
      
      // Extract src (font files)
      const srcMatch = block.match(/src:\s*([^;]+);/i);
      if (srcMatch) {
        const urls = srcMatch[1].match(/url\(['"]?([^'"()]+)['"]?\)/g);
        if (urls) {
          font.files = urls.map(u => {
            const urlMatch = u.match(/url\(['"]?([^'"()]+)['"]?\)/);
            return urlMatch ? urlMatch[1] : u;
          });
        }
      }
      
      // Extract font-weight
      const weightMatch = block.match(/font-weight:\s*([^;]+);/i);
      if (weightMatch) font.weight = weightMatch[1].trim();
      
      // Extract font-style
      const styleMatch = block.match(/font-style:\s*([^;]+);/i);
      if (styleMatch) font.style = styleMatch[1].trim();
      
      // Extract font-display
      const displayMatch = block.match(/font-display:\s*([^;]+);/i);
      if (displayMatch) font.display = displayMatch[1].trim();
      
      // Extract unicode-range
      const unicodeMatch = block.match(/unicode-range:\s*([^;]+);/i);
      if (unicodeMatch) font.unicodeRange = unicodeMatch[1].trim();
      
      fonts.push(font);
    }
    
    // Extract ALL font-family declarations with context
    // This regex captures the selector and the font-family value
    const cssRules = cssText.split('}');
    
    for (let rule of cssRules) {
      if (!rule.trim()) continue;
      
      const parts = rule.split('{');
      if (parts.length < 2) continue;
      
      const selector = parts[0].trim();
      const declarations = parts[1];
      
      // Find all font-family declarations in this rule
      const fontFamilyRegex = /font-family:\s*([^;]+);?/gi;
      let familyMatch;
      
      while ((familyMatch = fontFamilyRegex.exec(declarations)) !== null) {
        const fullValue = familyMatch[1].trim();
        
        // Parse the font stack
        const fontStack = fullValue.split(',').map(f => f.trim().replace(/['"]/g, ''));
        
        fontFamilyUsages.push({
          selector: selector,
          fullValue: fullValue,
          fontStack: fontStack,
          primaryFont: fontStack[0],
          fallbacks: fontStack.slice(1),
          source: sourceUrl
        });
      }
    }
    
    return { 
      fontFaces: fonts, 
      fontFamilyUsages: fontFamilyUsages
    };
  };

  const scanWebsite = async () => {
    if (!url) {
      setError('Please enter a URL');
      return;
    }

    setLoading(true);
    setError('');
    setResults(null);
    setDebugInfo([]);

    try {
      // Fetch the HTML page
      const response = await fetch('https://api.anthropic.com/v1/messages', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          model: 'claude-sonnet-4-20250514',
          max_tokens: 1000,
          messages: [{
            role: 'user',
            content: `Fetch this URL and extract all CSS file links and inline styles: ${url}. Return ONLY a JSON object with this structure: {"cssLinks": ["url1", "url2"], "hasInlineStyles": true/false}. No other text.`
          }],
          tools: [{
            type: "web_fetch_20250304",
            name: "web_fetch"
          }]
        })
      });

      const data = await response.json();
      
      // Process the response to extract CSS URLs
      let cssLinks = [];
      let htmlContent = '';
      
      if (data.content) {
        for (const block of data.content) {
          if (block.type === 'tool_use' && block.name === 'web_fetch') {
            // Will be in tool_result in next turn
          } else if (block.type === 'text') {
            htmlContent += block.text;
          }
        }
      }

      // Parse HTML content to find CSS links
      const parser = new DOMParser();
      const doc = parser.parseFromString(htmlContent, 'text/html');
      const linkTags = doc.querySelectorAll('link[rel="stylesheet"]');
      const styleTags = doc.querySelectorAll('style');
      
      cssLinks = Array.from(linkTags).map(link => {
        const href = link.getAttribute('href');
        if (href.startsWith('http')) return href;
        if (href.startsWith('//')) return 'https:' + href;
        if (href.startsWith('/')) {
          const baseUrl = new URL(url);
          return baseUrl.origin + href;
        }
        return new URL(href, url).href;
      });

      const allFonts = [];
      const allFontFamilyUsages = [];
      const cssFiles = [];
      const debug = [];

      debug.push(`Found ${linkTags.length} external CSS links`);
      debug.push(`Found ${styleTags.length} inline style tags`);

      // Process inline styles
      for (const styleTag of styleTags) {
        const cssText = styleTag.textContent;
        const { fontFaces, fontFamilyUsages } = extractFontsFromCSS(cssText, 'inline-style');
        allFonts.push(...fontFaces);
        allFontFamilyUsages.push(...fontFamilyUsages);
        if (fontFaces.length > 0 || fontFamilyUsages.length > 0) {
          cssFiles.push({ 
            url: 'Inline <style> tag', 
            fontFaceCount: fontFaces.length,
            fontFamilyCount: fontFamilyUsages.length,
            size: `${(cssText.length / 1024).toFixed(2)} KB`
          });
          debug.push(`Inline style: ${fontFaces.length} @font-face, ${fontFamilyUsages.length} font-family`);
        }
      }

      // Fetch and process external CSS files (limited to first 10 for performance)
      debug.push(`\nFetching external CSS files (max 10)...`);
      
      for (let i = 0; i < Math.min(cssLinks.length, 10); i++) {
        const cssUrl = cssLinks[i];
        try {
          debug.push(`\nFetching: ${cssUrl}`);
          const cssResponse = await fetch(cssUrl);
          const cssText = await cssResponse.text();
          
          debug.push(`‚úì Success: ${(cssText.length / 1024).toFixed(2)} KB`);
          
          const { fontFaces, fontFamilyUsages } = extractFontsFromCSS(cssText, cssUrl);
          allFonts.push(...fontFaces);
          allFontFamilyUsages.push(...fontFamilyUsages);
          
          const fileName = cssUrl.split('/').pop() || cssUrl;
          cssFiles.push({ 
            url: cssUrl,
            fileName: fileName,
            fontFaceCount: fontFaces.length,
            fontFamilyCount: fontFamilyUsages.length,
            size: `${(cssText.length / 1024).toFixed(2)} KB`,
            status: 'success'
          });
          
          debug.push(`  ‚Üí Found: ${fontFaces.length} @font-face, ${fontFamilyUsages.length} font-family`);
        } catch (err) {
          debug.push(`‚úó Failed: ${err.message}`);
          cssFiles.push({
            url: cssUrl,
            fileName: cssUrl.split('/').pop() || cssUrl,
            fontFaceCount: 0,
            fontFamilyCount: 0,
            size: 'N/A',
            status: 'failed',
            error: err.message
          });
        }
      }

      // Count unique fonts
      const uniquePrimaryFonts = new Set(allFontFamilyUsages.map(u => u.primaryFont));

      debug.push(`\n=== Summary ===`);
      debug.push(`Total @font-face: ${allFonts.length}`);
      debug.push(`Total font-family: ${allFontFamilyUsages.length}`);
      debug.push(`Unique primary fonts: ${uniquePrimaryFonts.size}`);

      setDebugInfo(debug);
      setResults({
        fonts: allFonts,
        fontFamilyUsages: allFontFamilyUsages,
        uniquePrimaryFonts: Array.from(uniquePrimaryFonts),
        cssFiles: cssFiles,
        totalCssFiles: cssLinks.length
      });

    } catch (err) {
      setError(`Error scanning website: ${err.message}`);
    } finally {
      setLoading(false);
    }
  };

  const exportResults = () => {
    const dataStr = JSON.stringify(results, null, 2);
    const dataBlob = new Blob([dataStr], { type: 'application/json' });
    const url = URL.createObjectURL(dataBlob);
    const link = document.createElement('a');
    link.href = url;
    link.download = 'font-metadata.json';
    link.click();
    URL.revokeObjectURL(url);
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 p-6">
      <div className="max-w-6xl mx-auto">
        <div className="text-center mb-8">
          <div className="flex items-center justify-center gap-3 mb-4">
            <Type className="w-10 h-10 text-purple-400" />
            <h1 className="text-4xl font-bold text-white">Font Metadata Scanner</h1>
          </div>
          <p className="text-purple-200">Analyze and extract detailed font information from any website</p>
        </div>

        <div className="bg-white/10 backdrop-blur-md rounded-xl p-6 shadow-2xl mb-6">
          <div className="flex gap-3">
            <input
              type="text"
              value={url}
              onChange={(e) => setUrl(e.target.value)}
              placeholder="Enter website URL (e.g., https://example.com)"
              className="flex-1 px-4 py-3 bg-white/20 border border-purple-300/30 rounded-lg text-white placeholder-purple-200/60 focus:outline-none focus:ring-2 focus:ring-purple-400"
              onKeyPress={(e) => e.key === 'Enter' && scanWebsite()}
            />
            <button
              onClick={scanWebsite}
              disabled={loading}
              className="px-6 py-3 bg-purple-600 hover:bg-purple-700 disabled:bg-purple-800 text-white rounded-lg font-semibold flex items-center gap-2 transition-colors"
            >
              {loading ? (
                <>
                  <div className="w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin" />
                  Scanning...
                </>
              ) : (
                <>
                  <Search className="w-5 h-5" />
                  Scan
                </>
              )}
            </button>
          </div>
          {error && (
            <div className="mt-4 p-4 bg-red-500/20 border border-red-500/50 rounded-lg text-red-200">
              {error}
            </div>
          )}
        </div>

        {results && (
          <div className="space-y-6">
            {debugInfo.length > 0 && (
              <div className="bg-black/40 backdrop-blur-md rounded-xl p-6 border border-green-500/30">
                <h3 className="text-xl font-bold text-green-400 mb-4 flex items-center gap-2">
                  <FileText className="w-5 h-5" />
                  Debug Log - CSS File Processing
                </h3>
                <div className="bg-black/60 rounded-lg p-4 font-mono text-sm text-green-300 max-h-96 overflow-y-auto">
                  {debugInfo.map((line, idx) => (
                    <div key={idx} className="mb-1">
                      {line}
                    </div>
                  ))}
                </div>
              </div>
            )}

            <div className="flex items-center justify-between">
              <h2 className="text-2xl font-bold text-white">Scan Results</h2>
              <button
                onClick={exportResults}
                className="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg flex items-center gap-2 transition-colors"
              >
                <Download className="w-4 h-4" />
                Export JSON
              </button>
            </div>

            <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
              <div className="bg-white/10 backdrop-blur-md rounded-lg p-6">
                <div className="text-3xl font-bold text-purple-400">{results.fonts.length}</div>
                <div className="text-purple-200">@font-face Declarations</div>
              </div>
              <div className="bg-white/10 backdrop-blur-md rounded-lg p-6">
                <div className="text-3xl font-bold text-purple-400">{results.fontFamilyUsages.length}</div>
                <div className="text-purple-200">font-family Declarations</div>
              </div>
              <div className="bg-white/10 backdrop-blur-md rounded-lg p-6">
                <div className="text-3xl font-bold text-purple-400">{results.uniquePrimaryFonts.length}</div>
                <div className="text-purple-200">Unique Primary Fonts</div>
              </div>
            </div>

                                {results.categorizedFonts && (
                      <div className="bg-white/10 backdrop-blur-md rounded-xl p-6">
                        <h3 className="text-xl font-bold text-white mb-4 flex items-center gap-2">
                          <Type />
                          Fonts by Category & License Status
                        </h3>
                        
                        <div className="space-y-6">
                          {/* Google Fonts */}
                          {results.categorizedFonts['Google Fonts'].length > 0 && (
                            <div className="bg-green-500/10 border border-green-500/30 rounded-lg p-4">
                              <div className="flex items-center justify-between mb-3">
                                <h4 className="text-lg font-bold text-green-300">
                                  üü¢ Google Fonts ({results.categorizedFonts['Google Fonts'].length})
                                </h4>
                                <span className="text-xs bg-green-500/20 text-green-300 px-3 py-1 rounded-full">
                                  Free (Open Source)
                                </span>
                              </div>
                              <div className="flex flex-wrap gap-2">
                                {results.categorizedFonts['Google Fonts'].map((font, idx) => (
                                  <span key={idx} className="px-3 py-1 bg-green-600/20 text-green-200 rounded-full text-sm border border-green-400/30">
                                    {font.primaryFont}
                                  </span>
                                ))}
                              </div>
                            </div>
                          )}
                          
                          {/* Microsoft/System Fonts */}
                          {results.categorizedFonts['Microsoft/System'].length > 0 && (
                            <div className="bg-blue-500/10 border border-blue-500/30 rounded-lg p-4">
                              <div className="flex items-center justify-between mb-3">
                                <h4 className="text-lg font-bold text-blue-300">
                                  üîµ Microsoft/System Fonts ({results.categorizedFonts['Microsoft/System'].length})
                                </h4>
                                <span className="text-xs bg-blue-500/20 text-blue-300 px-3 py-1 rounded-full">
                                  Bundled with OS
                                </span>
                              </div>
                              <div className="flex flex-wrap gap-2">
                                {results.categorizedFonts['Microsoft/System'].map((font, idx) => (
                                  <span key={idx} className="px-3 py-1 bg-blue-600/20 text-blue-200 rounded-full text-sm border border-blue-400/30">
                                    {font.primaryFont}
                                  </span>
                                ))}
                              </div>
                            </div>
                          )}
                          
                          {/* Adobe Fonts */}
                          {results.categorizedFonts['Adobe Fonts'].length > 0 && (
                            <div className="bg-purple-500/10 border border-purple-500/30 rounded-lg p-4">
                              <div className="flex items-center justify-between mb-3">
                                <h4 className="text-lg font-bold text-purple-300">
                                  üü£ Adobe Fonts ({results.categorizedFonts['Adobe Fonts'].length})
                                </h4>
                                <span className="text-xs bg-purple-500/20 text-purple-300 px-3 py-1 rounded-full">
                                  Subscription Required
                                </span>
                              </div>
                              <div className="flex flex-wrap gap-2">
                                {results.categorizedFonts['Adobe Fonts'].map((font, idx) => (
                                  <span key={idx} className="px-3 py-1 bg-purple-600/20 text-purple-200 rounded-full text-sm border border-purple-400/30">
                                    {font.primaryFont}
                                  </span>
                                ))}
                              </div>
                            </div>
                          )}
                          
                          {/* 3rd Party Fonts - License Warning */}
                          {results.categorizedFonts['3rd Party'].length > 0 && (
                            <div className="bg-orange-500/10 border border-orange-500/30 rounded-lg p-4">
                              <div className="flex items-center justify-between mb-3">
                                <h4 className="text-lg font-bold text-orange-300">
                                  ‚ö†Ô∏è 3rd Party Fonts ({results.categorizedFonts['3rd Party'].length})
                                </h4>
                                <span className="text-xs bg-orange-500/20 text-orange-300 px-3 py-1 rounded-full">
                                  License Required - Verify
                                </span>
                              </div>
                              <div className="bg-orange-500/5 rounded p-3 mb-3 text-orange-200 text-sm">
                                ‚ö†Ô∏è <strong>License Verification Required:</strong> These fonts may require commercial licenses. 
                                Please verify with the font vendor before use in production.
                              </div>
                              <div className="space-y-2">
                                {results.categorizedFonts['3rd Party'].map((font, idx) => (
                                  <div key={idx} className="bg-orange-600/10 border border-orange-500/20 rounded p-3">
                                    <div className="flex items-start justify-between">
                                      <div className="flex-1">
                                        <div className="font-semibold text-orange-200 mb-1">
                                          {font.primaryFont}
                                        </div>
                                        <div className="text-xs text-orange-300">
                                          Source: {font.source === 'inline-style' ? 'Inline Style' : font.source.split('/').slice(-2).join('/')}
                                        </div>
                                      </div>
                                      {font.detected && (
                                        <span className="text-xs text-orange-400 bg-orange-500/10 px-2 py-1 rounded ml-2">
                                          {font.detected}
                                        </span>
                                      )}
                                    </div>
                                  </div>
                                ))}
                              </div>
                            </div>
                          )}
                          
                          {/* Generic/Fallback */}
                          {results.categorizedFonts['Generic/Fallback'].length > 0 && (
                            <div className="bg-gray-500/10 border border-gray-500/30 rounded-lg p-4">
                              <div className="flex items-center justify-between mb-3">
                                <h4 className="text-lg font-bold text-gray-300">
                                  ‚ö™ Generic/Fallback Fonts ({results.categorizedFonts['Generic/Fallback'].length})
                                </h4>
                                <span className="text-xs bg-gray-500/20 text-gray-300 px-3 py-1 rounded-full">
                                  N/A
                                </span>
                              </div>
                              <div className="flex flex-wrap gap-2">
                                {results.categorizedFonts['Generic/Fallback'].map((font, idx) => (
                                  <span key={idx} className="px-3 py-1 bg-gray-600/20 text-gray-200 rounded-full text-sm border border-gray-400/30">
                                    {font.primaryFont}
                                  </span>
                                ))}
                              </div>
                            </div>
                          )}
                        </div>
                      </div>
                    )}

                    {results.fontFamilyUsages.length > 0 && (
              <div className="bg-white/10 backdrop-blur-md rounded-xl p-6">
                <h3 className="text-xl font-bold text-white mb-4 flex items-center gap-2">
                  <Type className="w-5 h-5" />
                  Font-Family Declarations ({results.fontFamilyUsages.length} found)
                </h3>
                <div className="space-y-3 max-h-96 overflow-y-auto">
                  {results.fontFamilyUsages.map((usage, idx) => (
                    <div key={idx} className="bg-white/5 rounded-lg p-4 border border-purple-300/20">
                      <div className="mb-2">
                        <span className="text-purple-200 text-xs">CSS Selector:</span>
                        <div className="text-purple-100 text-sm font-mono bg-black/20 px-2 py-1 rounded mt-1">
                          {usage.selector}
                        </div>
                      </div>
                      <div className="mb-2">
                        <span className="text-purple-200 text-xs">Full Declaration:</span>
                        <div className="text-white text-sm font-mono bg-black/20 px-2 py-1 rounded mt-1">
                          font-family: {usage.fullValue};
                        </div>
                      </div>
                      <div className="grid grid-cols-1 gap-2">
                        <div>
                          <span className="text-purple-200 text-xs">Primary Font:</span>
                          <span className="text-green-300 text-sm ml-2 font-semibold">{usage.primaryFont}</span>
                        </div>
                        {usage.fallbacks.length > 0 && (
                          <div>
                            <span className="text-purple-200 text-xs">Fallback Stack:</span>
                            <div className="text-purple-100 text-sm mt-1">
                              {usage.fallbacks.join(' ‚Üí ')}
                            </div>
                          </div>
                        )}
                      </div>
                      <div className="text-xs text-purple-300 mt-2">
                        Source: {usage.source === 'inline-style' ? 'Inline Style' : new URL(usage.source).pathname.split('/').pop()}
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            )}

            {results.fonts.length > 0 && (
              <div className="bg-white/10 backdrop-blur-md rounded-xl p-6">
                <h3 className="text-xl font-bold text-white mb-4 flex items-center gap-2">
                  <FileText className="w-5 h-5" />
                  @font-face Declarations ({results.fonts.length} found)
                </h3>
                <div className="space-y-4 max-h-96 overflow-y-auto">
                  {results.fonts.map((font, idx) => (
                    <div key={idx} className="bg-white/5 rounded-lg p-4 border border-purple-300/20">
                      <div className="font-semibold text-purple-300 text-lg mb-2">
                        {font.family || 'Unnamed Font'}
                      </div>
                      <div className="grid grid-cols-2 gap-2 text-sm">
                        {font.weight && (
                          <div><span className="text-purple-200">Weight:</span> <span className="text-white">{font.weight}</span></div>
                        )}
                        {font.style && (
                          <div><span className="text-purple-200">Style:</span> <span className="text-white">{font.style}</span></div>
                        )}
                        {font.display && (
                          <div><span className="text-purple-200">Display:</span> <span className="text-white">{font.display}</span></div>
                        )}
                        {font.unicodeRange && (
                          <div className="col-span-2"><span className="text-purple-200">Unicode Range:</span> <span className="text-white text-xs">{font.unicodeRange}</span></div>
                        )}
                      </div>
                      {font.files && (
                        <div className="mt-3">
                          <div className="text-purple-200 text-xs mb-1">Font Files:</div>
                          {font.files.map((file, i) => (
                            <div key={i} className="text-xs text-purple-100 truncate bg-white/5 px-2 py-1 rounded mt-1">
                              {file}
                            </div>
                          ))}
                        </div>
                      )}
                      <div className="text-xs text-purple-300 mt-2">
                        Source: {font.source === 'inline-style' ? 'Inline Style' : font.source.split('/').pop()}
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            )}

            {results.uniquePrimaryFonts && results.uniquePrimaryFonts.length > 0 && (
              <div className="bg-white/10 backdrop-blur-md rounded-xl p-6">
                <h3 className="text-xl font-bold text-white mb-4">Unique Primary Fonts</h3>
                <div className="flex flex-wrap gap-2">
                  {results.uniquePrimaryFonts.map((family, idx) => (
                    <span key={idx} className="px-3 py-1 bg-purple-600/30 text-purple-100 rounded-full text-sm border border-purple-400/30">
                      {family}
                    </span>
                  ))}
                </div>
              </div>
            )}

            {results.cssFiles.length > 0 && (
              <div className="bg-white/10 backdrop-blur-md rounded-xl p-6">
                <h3 className="text-xl font-bold text-white mb-4">CSS Files Analyzed ({results.cssFiles.length})</h3>
                <div className="space-y-2">
                  {results.cssFiles.map((file, idx) => (
                    <div key={idx} className={`rounded-lg p-4 border ${file.status === 'failed' ? 'bg-red-500/10 border-red-500/30' : 'bg-white/5 border-purple-300/20'}`}>
                      <div className="flex items-start justify-between mb-2">
                        <div className="flex-1">
                          <div className="text-purple-100 text-sm font-semibold mb-1">
                            {file.fileName || 'Inline Style'}
                          </div>
                          <div className="text-purple-300 text-xs font-mono truncate">
                            {file.url}
                          </div>
                        </div>
                        <div className="text-xs text-purple-400 ml-4">
                          {file.size}
                        </div>
                      </div>
                      {file.status === 'failed' ? (
                        <div className="text-red-300 text-xs mt-2">
                          ‚úó Failed to load: {file.error}
                        </div>
                      ) : (
                        <div className="flex gap-4 text-sm mt-2">
                          <span className="text-purple-300">
                            <span className="font-semibold">{file.fontFaceCount}</span> @font-face
                          </span>
                          <span className="text-green-300">
                            <span className="font-semibold">{file.fontFamilyCount}</span> font-family
                          </span>
                        </div>
                      )}
                    </div>
                  ))}
                </div>
              </div>
            )}
          </div>
        )}
      </div>
    </div>
  );
}
